<div class="goals-container fade-in">
    <div class="header-actions">
        <div class="header-text">
            <h2>Savings Goals</h2>
            <p>Track your progress towards financial freedom</p>
        </div>
        <button class="btn btn-primary" (click)="toggleForm()">
            <span class="icon">{{ showForm ? '‚úï' : '+' }}</span>
            {{ showForm ? 'Cancel' : 'New Goal' }}
        </button>
    </div>

    <!-- Add Goal Form -->
    <div class="card form-card" *ngIf="showForm">
        <h3>Create New Goal</h3>
        <form [formGroup]="goalForm" (ngSubmit)="onSubmit()">
            <div class="form-group">
                <label for="name">Goal Name</label>
                <input id="name" type="text" formControlName="name" placeholder="e.g., New Car, Vacation">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="target_amount">Target Amount</label>
                    <input id="target_amount" type="number" formControlName="target_amount" placeholder="0.00">
                </div>

                <div class="form-group">
                    <label for="current_amount">Current Savings</label>
                    <input id="current_amount" type="number" formControlName="current_amount" placeholder="0.00">
                </div>
            </div>

            <div class="form-group">
                <label for="deadline">Target Date</label>
                <input id="deadline" type="date" formControlName="deadline">
            </div>

            <button type="submit" class="btn btn-primary w-100" [disabled]="goalForm.invalid || isLoading">
                {{ isLoading ? 'Creating...' : 'Create Goal' }}
            </button>
        </form>
    </div>

    <!-- Goals Grid -->
    <div class="goals-grid" *ngIf="!isLoading; else loading">
        <div *ngIf="goals.length === 0" class="empty-state card">
            <p>No goals set yet. Start saving today!</p>
        </div>

        <div *ngFor="let goal of goals" class="card goal-card">
            <div class="goal-header">
                <h3>{{ goal.name }}</h3>
                <div class="actions">
                    <button class="btn-icon add-btn" (click)="openAddAmount(goal.id)" title="Add Money">+</button>
                    <button class="btn-icon delete-btn" (click)="deleteGoal(goal.id)" title="Delete">üóëÔ∏è</button>
                </div>
            </div>

            <div class="goal-amounts">
                <span class="current">{{ goal.current_amount | currency }}</span>
                <span class="target">of {{ goal.target_amount | currency }}</span>
            </div>

            <div class="progress-container">
                <div class="progress-bar" [style.width.%]="getProgress(goal)"></div>
            </div>
            <p class="days-left" *ngIf="goal.deadline">Target: {{ goal.deadline | date }}</p>

            <!-- Add Money Input (Inline) -->
            <div class="add-money-form" *ngIf="addingToGoalId === goal.id">
                <input type="number" [(ngModel)]="amountToAdd" placeholder="Amount" min="1">
                <button class="btn btn-sm btn-primary" (click)="submitAddAmount()">Save</button>
                <button class="btn btn-sm btn-secondary" (click)="cancelAddAmount()">Cancel</button>
            </div>
        </div>
    </div>

    <ng-template #loading>
        <div class="progress-bar-container">
            <p>Loading goals...</p>
        </div>
    </ng-template>
</div>